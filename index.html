<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecumenical Forum - Project Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #FFFBF0;
            color: #1F2937;
        }

        /* Login Page */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #1F2937;
        }

        .login-box {
            background: white;
            padding: 48px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            text-align: center;
            max-width: 420px;
            width: 90%;
            border-top: 4px solid #B91C1C;
        }

        .login-box h1 {
            color: #1F2937;
            margin-bottom: 8px;
            font-size: 28px;
            font-weight: 600;
        }

        .login-box p {
            color: #6B7280;
            margin-bottom: 32px;
            font-size: 15px;
        }

        .login-box input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 15px;
            margin-bottom: 16px;
            transition: border-color 0.2s;
        }

        .login-box input:focus {
            outline: none;
            border-color: #B91C1C;
        }

        .login-box button {
            width: 100%;
            padding: 12px;
            background: #B91C1C;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .login-box button:hover {
            background: #991515;
        }

        .error-message {
            color: #EF4444;
            margin-top: 12px;
            font-size: 14px;
            display: none;
        }

        .user-badge {
            display: inline-block;
            padding: 4px 12px;
            background: #F59E0B;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        /* Main App */
        .app-container {
            display: none;
        }

        /* Header */
        .app-header {
            background: white;
            border-bottom: 1px solid #E5E7EB;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 32px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: #1F2937;
        }

        .logo-accent {
            color: #B91C1C;
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
        }

        .nav-tab {
            padding: 8px 16px;
            color: #6B7280;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .nav-tab:hover {
            background: #F9FAFB;
            color: #1F2937;
        }

        .nav-tab.active {
            background: #FEF3C7;
            color: #92400E;
            border-color: #F59E0B;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: #F9FAFB;
            border-radius: 6px;
            font-size: 14px;
        }

        .user-role {
            background: #F59E0B;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .logout-btn {
            padding: 8px 16px;
            background: white;
            color: #6B7280;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #F9FAFB;
            border-color: #B91C1C;
            color: #B91C1C;
        }

        /* Pages */
        .page {
            display: none;
            max-width: 1600px;
            margin: 0 auto;
            padding: 32px;
        }

        .page.active {
            display: block;
        }

        /* Dashboard Page */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #6B7280;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .stat-controls {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .stat-btn {
            padding: 6px 12px;
            background: #F9FAFB;
            border: 1px solid #D1D5DB;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .stat-btn:hover {
            background: #F59E0B;
            color: white;
            border-color: #F59E0B;
        }

        .links-section {
            background: white;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 20px;
        }

        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
        }

        .link-card {
            padding: 16px;
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #1F2937;
            text-decoration: none;
            display: block;
            position: relative;
        }

        .link-card:hover {
            border-color: #F59E0B;
            background: white;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);
        }

        .link-card .action-icon-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }

        .link-card:hover .action-icon-btn {
            opacity: 1;
        }

        /* Project Tracker - Monday.com/Asana Style */
        .tracker-header {
            background: white;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .tracker-title {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
        }

        .add-btn {
            padding: 10px 20px;
            background: #B91C1C;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .add-btn:hover {
            background: #991515;
        }

        .add-btn.disabled {
            background: #D1D5DB;
            cursor: not-allowed;
        }

        /* Board View */
        .board-container {
            background: white;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .board-header {
            background: #F9FAFB;
            padding: 16px 24px;
            border-bottom: 2px solid #E5E7EB;
            display: grid;
            grid-template-columns: 3fr 1.5fr 1fr 1fr 1fr 120px;
            gap: 16px;
            font-weight: 600;
            font-size: 13px;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .board-row {
            padding: 16px 24px;
            border-bottom: 1px solid #F3F4F6;
            display: grid;
            grid-template-columns: 3fr 1.5fr 1fr 1fr 1fr 120px;
            gap: 16px;
            align-items: center;
            transition: background 0.15s;
            cursor: pointer;
        }

        .board-row:hover {
            background: #FFFBF0;
        }

        .project-name {
            font-weight: 600;
            color: #1F2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .expand-icon {
            color: #9CA3AF;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .expand-icon.expanded {
            transform: rotate(90deg);
        }

        .status-select {
            padding: 6px 12px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            background: white;
            font-weight: 500;
            transition: all 0.2s;
        }

        .status-select:hover {
            border-color: #D1D5DB;
        }

        .status-select:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .status-not-started {
            color: #6B7280;
            background: #F3F4F6;
        }

        .status-in-progress {
            color: #1E40AF;
            background: #DBEAFE;
        }

        .status-completed {
            color: #065F46;
            background: #D1FAE5;
        }

        .date-cell {
            font-size: 14px;
            color: #4B5563;
        }

        .assigned-cell {
            font-size: 14px;
            color: #4B5563;
        }

        .count-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #F3F4F6;
            border-radius: 4px;
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .row-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .action-icon-btn {
            padding: 6px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            color: #6B7280;
            font-size: 14px;
            transition: all 0.2s;
        }

        .action-icon-btn:hover {
            background: #F3F4F6;
            color: #1F2937;
        }

        .action-icon-btn.delete:hover {
            background: #FEE2E2;
            color: #DC2626;
        }

        .action-icon-btn:disabled {
            cursor: not-allowed;
            opacity: 0.4;
        }

        /* Expanded Row Details */
        .row-details {
            display: none;
            padding: 24px;
            background: #FFFBF0;
            border-top: 1px solid #E5E7EB;
        }

        .row-details.expanded {
            display: block;
        }

        .details-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            border-bottom: 2px solid #E5E7EB;
        }

        .detail-tab {
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 500;
            color: #6B7280;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .detail-tab:hover {
            color: #1F2937;
        }

        .detail-tab.active {
            color: #B91C1C;
            border-bottom-color: #B91C1C;
        }

        .detail-content {
            display: none;
        }

        .detail-content.active {
            display: block;
        }

        .description-box {
            padding: 16px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            line-height: 1.6;
            color: #4B5563;
        }

        /* Subtasks */
        .subtasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .subtask-item {
            padding: 12px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            margin-bottom: 8px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 100px;
            gap: 12px;
            align-items: center;
        }

        .subtask-name {
            font-weight: 500;
            color: #1F2937;
        }

        /* Files */
        .file-item {
            padding: 12px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 500;
            color: #1F2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .download-btn {
            padding: 6px 12px;
            background: #F59E0B;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .download-btn:hover {
            background: #D97706;
        }

        .upload-area {
            margin-top: 16px;
            padding: 24px;
            background: white;
            border: 2px dashed #D1D5DB;
            border-radius: 6px;
            text-align: center;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .upload-label {
            display: inline-block;
            padding: 10px 20px;
            background: #F9FAFB;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .upload-label:hover {
            background: #F59E0B;
            color: white;
            border-color: #F59E0B;
        }

        /* Comments */
        .comment-item {
            padding: 16px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: 600;
            color: #1F2937;
        }

        .comment-time {
            font-size: 12px;
            color: #9CA3AF;
        }

        .comment-text {
            color: #4B5563;
            line-height: 1.5;
        }

        .comment-form {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .comment-form input,
        .comment-form textarea {
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .comment-form textarea {
            min-height: 80px;
            resize: vertical;
        }

        .comment-form input:focus,
        .comment-form textarea:focus {
            outline: none;
            border-color: #F59E0B;
        }

        .submit-comment-btn {
            padding: 10px 20px;
            background: #B91C1C;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            align-self: flex-start;
            transition: background 0.2s;
        }

        .submit-comment-btn:hover {
            background: #991515;
        }

        .submit-comment-btn:disabled {
            background: #D1D5DB;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 32px;
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #E5E7EB;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1F2937;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #9CA3AF;
            padding: 4px;
            line-height: 1;
        }

        .close-modal:hover {
            color: #1F2937;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #F59E0B;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #E5E7EB;
        }

        .cancel-btn {
            padding: 10px 20px;
            background: white;
            color: #6B7280;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .cancel-btn:hover {
            background: #F9FAFB;
        }

        .submit-btn {
            padding: 10px 20px;
            background: #B91C1C;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .submit-btn:hover {
            background: #991515;
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: #9CA3AF;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #6B7280;
        }

        .small-btn {
            padding: 4px 10px;
            background: #F9FAFB;
            border: 1px solid #D1D5DB;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .small-btn:hover {
            background: #F59E0B;
            color: white;
            border-color: #F59E0B;
        }

        .small-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .small-btn.delete:hover {
            background: #EF4444;
            border-color: #EF4444;
        }

        /* Attendees List */
        .attendee-item {
            padding: 12px 16px;
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #1F2937;
            font-weight: 500;
        }

        .attendee-item::before {
            content: "‚úì";
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: #D1FAE5;
            color: #065F46;
            border-radius: 50%;
            font-weight: 700;
            font-size: 12px;
            flex-shrink: 0;
        }

        @keyframes scroll {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-50%);
            }
        }

        .attendees-scroll-container {
            display: flex;
            flex-direction: column;
        }

        .attendees-scroll-container.scrolling {
            animation: scroll linear infinite;
        }

        /* Attendees Page Cards */
        .attendee-card {
            padding: 20px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            transition: all 0.2s;
            position: relative;
        }

        .attendee-card:hover {
            border-color: #F59E0B;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .attendee-card::before {
            content: "‚úì";
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: #D1FAE5;
            color: #065F46;
            border-radius: 50%;
            font-weight: 700;
            font-size: 14px;
        }

        .attendee-name {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            padding-right: 40px;
        }

        .attendee-number {
            font-size: 12px;
            color: #9CA3AF;
            margin-top: 4px;
            font-weight: 500;
        }

        /* Project Details Modal Dashboard */
        .project-details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-top: 24px;
        }

        .project-details-section {
            background: #F9FAFB;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
        }

        .project-details-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-details-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .meta-box {
            background: white;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #E5E7EB;
        }

        .meta-box-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .meta-box-value {
            font-size: 16px;
            color: #1F2937;
            font-weight: 600;
        }

        .full-width-section {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <h1>Ecumenical Forum</h1>
            <p>Project Tracker</p>
            <input type="password" id="passwordInput" placeholder="Enter Password" />
            <button onclick="login()">Login</button>
            <div class="error-message" id="errorMessage">Incorrect password. Please try again.</div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo">
                        <span class="logo-accent">Ecumenical</span> Forum
                    </div>
                    <nav class="nav-tabs">
                        <div class="nav-tab active" onclick="switchPage('dashboard')">Dashboard</div>
                        <div class="nav-tab" onclick="switchPage('projects')">Projects</div>
                        <div class="nav-tab" onclick="switchPage('attendees')">Attendees</div>
                        <div class="nav-tab" onclick="switchPage('contracts')">Contracts</div>
                        <div class="nav-tab" id="settingsTab" onclick="switchPage('settings')" style="display: none;">Settings</div>
                    </nav>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <span id="userName">User</span>
                        <span class="user-role" id="userRole">View Only</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </header>

        <!-- Dashboard Page -->
        <div class="page active" id="dashboardPage">
            <div style="display: grid; grid-template-columns: 400px 1fr; gap: 24px; margin-bottom: 24px;">
                <!-- Left Column: Stats -->
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="stat-card" style="padding: 20px;">
                        <h3 style="font-size: 13px;">Event Registrations</h3>
                        <div class="stat-value" id="rsvpCount" style="font-size: 32px;">0</div>
                        <div class="stat-controls" id="rsvpControls">
                            <button class="stat-btn" onclick="adjustRSVP(1)">+ Add</button>
                            <button class="stat-btn" onclick="adjustRSVP(-1)">- Remove</button>
                        </div>
                    </div>
                    <div class="stat-card" style="padding: 20px;">
                        <h3 style="font-size: 13px;">Active Projects</h3>
                        <div class="stat-value" id="activeProjectsCount" style="font-size: 32px;">0</div>
                    </div>
                    <div class="stat-card" id="completedProjectsCard" style="padding: 20px;">
                        <h3 style="font-size: 13px;">Completed Projects</h3>
                        <div class="stat-value" id="completedProjectsCount" style="font-size: 32px;">0</div>
                    </div>
                </div>

                <!-- Right Column: Confirmed Attendees -->
                <div class="stat-card" style="padding: 24px; display: flex; flex-direction: column;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-size: 16px; font-weight: 700; color: #1F2937; margin: 0;">Confirmed Attendees</h3>
                        <button class="small-btn" id="manageAttendeesBtn" onclick="openAttendeesModal()" style="display: none;">Manage</button>
                    </div>
                    <div id="attendeesList" style="flex: 1; overflow-y: auto; max-height: 320px; min-height: 200px;">
                        <!-- Attendees will be rendered here -->
                    </div>
                    <div id="noAttendees" style="text-align: center; padding: 48px 24px; color: #9CA3AF; display: none;">
                        <p>No confirmed attendees yet</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); margin-top: 24px;">
                <div class="stat-card">
                    <h3>Tim's Zoom Link</h3>
                    <div style="margin-top: 16px;" id="zoomAdminControls">
                        <input type="text" id="zoomLinkInput" placeholder="Enter Zoom Link" style="width: 100%; padding: 10px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px; margin-bottom: 12px;" />
                        <button class="stat-btn" onclick="saveZoomLink()" style="width: 100%; margin-bottom: 12px;">Save Link</button>
                    </div>
                    <div id="zoomPublicView">
                        <a id="zoomLinkButton" href="#" target="_blank" class="stat-btn" style="width: 100%; display: none; text-decoration: none; text-align: center; background: #2563EB; color: white; padding: 10px; margin-bottom: 12px;">Join Zoom Meeting</a>
                        <div id="zoomNotSet" style="padding: 12px; background: #F3F4F6; border-radius: 6px; text-align: center; color: #6B7280; font-size: 14px; margin-bottom: 12px; display: none;">
                            Zoom link not set yet
                        </div>
                    </div>
                    <div style="margin-top: 12px; padding: 12px; background: #F3F4F6; border-radius: 6px;">
                        <div style="font-size: 13px; color: #6B7280; margin-bottom: 4px;">Meeting Password:</div>
                        <div style="font-size: 18px; font-weight: 700; color: #1F2937; font-family: monospace;">1234567</div>
                    </div>
                </div>

                <div class="stat-card">
                    <h3>Invitation Form</h3>
                    <form id="invitationForm" style="margin-top: 16px;">
                        <div style="margin-bottom: 12px;">
                            <input type="text" id="firstName" placeholder="First Name *" required style="width: 100%; padding: 10px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px;" />
                        </div>
                        <div style="margin-bottom: 12px;">
                            <input type="text" id="lastName" placeholder="Last Name *" required style="width: 100%; padding: 10px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px;" />
                        </div>
                        <div style="margin-bottom: 12px;">
                            <input type="email" id="email" placeholder="Email *" required style="width: 100%; padding: 10px 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px;" />
                        </div>
                        <button type="submit" class="stat-btn" style="width: 100%; background: #B91C1C; color: white; padding: 10px;">Submit Invitation</button>
                    </form>
                    <div id="formSuccess" style="display: none; margin-top: 12px; padding: 12px; background: #D1FAE5; color: #065F46; border-radius: 6px; font-size: 14px; text-align: center;">
                        ‚úì Invitation submitted successfully!
                    </div>
                    <div id="formError" style="display: none; margin-top: 12px; padding: 12px; background: #FEE2E2; color: #DC2626; border-radius: 6px; font-size: 14px; text-align: center;">
                        Error submitting form. Please try again.
                    </div>
                </div>
            </div>

            <div class="links-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="section-title" style="margin-bottom: 0;">Important Documents & Links</div>
                    <button class="add-btn" id="addLinkBtn" onclick="openLinkModal()" style="display: none;">
                        <span>+</span> Add Link
                    </button>
                </div>
                <div class="links-grid" id="importantLinksList"></div>
            </div>

            <div class="links-section">
                <div class="section-title">Current Projects</div>
                <div id="dashboardProjectsList"></div>
            </div>
        </div>

        <!-- Projects Page -->
        <div class="page" id="projectsPage">
            <div class="tracker-header">
                <h1 class="tracker-title">Projects</h1>
                <button class="add-btn" id="addProjectBtn" onclick="openProjectModal()">
                    <span>+</span> Add Project
                </button>
            </div>

            <div class="board-container">
                <div class="board-header">
                    <div>Project</div>
                    <div>Assigned</div>
                    <div>Due Date</div>
                    <div>Status</div>
                    <div>Items</div>
                    <div>Actions</div>
                </div>
                <div id="projectsList"></div>
            </div>
        </div>

        <!-- Attendees Page -->
        <div class="page" id="attendeesPage">
            <div class="tracker-header">
                <h1 class="tracker-title">Confirmed Attendees</h1>
                <button class="add-btn" id="manageAttendeesBtn2" onclick="openAttendeesModal()" style="display: none;">
                    <span>+</span> Manage Attendees
                </button>
            </div>

            <div class="board-container" style="padding: 32px;">
                <!-- Search Bar -->
                <div style="margin-bottom: 24px;">
                    <input 
                        type="text" 
                        id="attendeeSearch" 
                        placeholder="Search attendees..." 
                        style="width: 100%; max-width: 400px; padding: 12px 16px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px;"
                        onkeyup="filterAttendees()"
                    />
                </div>

                <!-- Stats -->
                <div style="display: flex; gap: 24px; margin-bottom: 32px;">
                    <div style="padding: 16px 24px; background: #F9FAFB; border-radius: 8px; border-left: 4px solid #B91C1C;">
                        <div style="font-size: 13px; color: #6B7280; margin-bottom: 4px; font-weight: 600; text-transform: uppercase;">Total Confirmed</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1F2937;" id="totalAttendeesCount">0</div>
                    </div>
                    <div style="padding: 16px 24px; background: #F9FAFB; border-radius: 8px; border-left: 4px solid #F59E0B;">
                        <div style="font-size: 13px; color: #6B7280; margin-bottom: 4px; font-weight: 600; text-transform: uppercase;">Displaying</div>
                        <div style="font-size: 32px; font-weight: 700; color: #1F2937;" id="displayedAttendeesCount">0</div>
                    </div>
                </div>

                <!-- Attendees Grid -->
                <div id="attendeesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
                    <!-- Attendee cards will be rendered here -->
                </div>

                <!-- Empty State -->
                <div id="noAttendeesPage" style="display: none; text-align: center; padding: 80px 24px; color: #9CA3AF;">
                    <div style="font-size: 48px; margin-bottom: 16px;">üë•</div>
                    <h3 style="font-size: 20px; color: #6B7280; margin-bottom: 8px;">No Attendees Yet</h3>
                    <p style="font-size: 14px;">Click "Manage Attendees" to add confirmed attendees to the list</p>
                </div>

                <!-- No Search Results -->
                <div id="noSearchResults" style="display: none; text-align: center; padding: 80px 24px; color: #9CA3AF;">
                    <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                    <h3 style="font-size: 20px; color: #6B7280; margin-bottom: 8px;">No Results Found</h3>
                    <p style="font-size: 14px;">Try searching with a different name</p>
                </div>
            </div>
        </div>

        <!-- Contracts Page -->
        <div class="page" id="contractsPage">
            <div class="tracker-header">
                <h1 class="tracker-title">Contracts</h1>
                <button class="add-btn" id="uploadContractBtn" onclick="document.getElementById('contractUpload').click()">
                    <span>+</span> Upload Contract
                </button>
                <input type="file" id="contractUpload" style="display: none;" onchange="uploadContract(this)" multiple accept=".pdf,.doc,.docx">
            </div>

            <div class="board-container">
                <div id="contractsList"></div>
            </div>
        </div>

        <!-- Settings Page -->
        <div class="page" id="settingsPage">
            <div class="tracker-header">
                <h1 class="tracker-title">Settings</h1>
            </div>

            <div class="board-container" style="padding: 32px;">
                <div style="max-width: 800px;">
                    <h2 style="font-size: 20px; font-weight: 700; color: #1F2937; margin-bottom: 24px;">Webhook Configuration</h2>
                    
                    <div class="form-group">
                        <label>n8n Webhook URL for Invitation Form</label>
                        <input type="url" id="webhookUrlInput" placeholder="https://your-n8n-instance.com/webhook/..." style="width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px;" />
                        <small style="color: #6B7280; font-size: 13px; display: block; margin-top: 8px;">
                            This webhook will receive invitation form submissions and send them to Google Sheets.
                        </small>
                    </div>

                    <div style="margin-top: 24px;">
                        <button class="add-btn" onclick="saveWebhookUrl()" style="margin-right: 12px;">
                            Save Settings
                        </button>
                        <button class="cancel-btn" onclick="testWebhook()">
                            Test Connection
                        </button>
                    </div>

                    <div id="settingsSuccess" style="display: none; margin-top: 16px; padding: 12px; background: #D1FAE5; color: #065F46; border-radius: 6px; font-size: 14px;">
                        ‚úì Settings saved successfully!
                    </div>

                    <div id="settingsError" style="display: none; margin-top: 16px; padding: 12px; background: #FEE2E2; color: #DC2626; border-radius: 6px; font-size: 14px;">
                        Error saving settings. Please check the URL format.
                    </div>

                    <div id="testSuccess" style="display: none; margin-top: 16px; padding: 12px; background: #DBEAFE; color: #1E40AF; border-radius: 6px; font-size: 14px;">
                        ‚úì Webhook connection successful!
                    </div>

                    <div id="testError" style="display: none; margin-top: 16px; padding: 12px; background: #FEE2E2; color: #DC2626; border-radius: 6px; font-size: 14px;">
                        ‚úó Webhook connection failed. Please check the URL and try again.
                    </div>

                    <div style="margin-top: 48px; padding: 24px; background: #F9FAFB; border-radius: 8px; border: 1px solid #E5E7EB;">
                        <h3 style="font-size: 16px; font-weight: 700; color: #1F2937; margin-bottom: 12px;">Setup Instructions</h3>
                        <ol style="color: #4B5563; line-height: 1.8; padding-left: 20px;">
                            <li>Create a webhook trigger in your n8n workflow</li>
                            <li>Set the HTTP method to <strong>POST</strong></li>
                            <li>Copy the webhook URL and paste it above</li>
                            <li>Add a Google Sheets node to your workflow</li>
                            <li>Map the form fields: firstName, lastName, email, timestamp</li>
                            <li>Activate your workflow in n8n</li>
                            <li>Click "Test Connection" to verify</li>
                        </ol>
                        <p style="margin-top: 16px; color: #6B7280; font-size: 14px;">
                            üìò For detailed instructions, see the <strong>N8N_WEBHOOK_SETUP.md</strong> file in your repository.
                        </p>
                    </div>

                    <div style="margin-top: 32px; padding: 24px; background: #FFFBF0; border-radius: 8px; border-left: 4px solid #F59E0B;">
                        <h3 style="font-size: 16px; font-weight: 700; color: #92400E; margin-bottom: 12px;">‚ö†Ô∏è Important Notes</h3>
                        <ul style="color: #78350F; line-height: 1.8; padding-left: 20px;">
                            <li>The webhook URL must be publicly accessible</li>
                            <li>Make sure your n8n workflow is <strong>activated</strong></li>
                            <li>Test the connection before relying on the form</li>
                            <li>Form submissions will fail if the webhook is not configured</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add New Project</h2>
                <button class="close-modal" onclick="closeProjectModal()">&times;</button>
            </div>
            <form id="projectForm">
                <input type="hidden" id="projectId">
                <div class="form-group">
                    <label>Project Name *</label>
                    <input type="text" id="projectName" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="projectDescription"></textarea>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" id="projectDueDate">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="projectStatus">
                        <option value="not-started">Not Started</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Assigned To</label>
                    <input type="text" id="projectAssigned">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeProjectModal()">Cancel</button>
                    <button type="submit" class="submit-btn">Save Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Subtask Modal -->
    <div class="modal" id="subtaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="subtaskModalTitle">Add Subtask</h2>
                <button class="close-modal" onclick="closeSubtaskModal()">&times;</button>
            </div>
            <form id="subtaskForm">
                <input type="hidden" id="subtaskProjectId">
                <input type="hidden" id="subtaskId">
                <div class="form-group">
                    <label>Subtask Name *</label>
                    <input type="text" id="subtaskName" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="subtaskDescription"></textarea>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" id="subtaskDueDate">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="subtaskStatus">
                        <option value="not-started">Not Started</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Assigned To</label>
                    <input type="text" id="subtaskAssigned">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeSubtaskModal()">Cancel</button>
                    <button type="submit" class="submit-btn">Save Subtask</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Link Modal -->
    <div class="modal" id="linkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="linkModalTitle">Add Link</h2>
                <button class="close-modal" onclick="closeLinkModal()">&times;</button>
            </div>
            <form id="linkForm">
                <input type="hidden" id="linkId">
                <div class="form-group">
                    <label>Link Name *</label>
                    <input type="text" id="linkName" placeholder="e.g., Foundational Documents" required>
                </div>
                <div class="form-group">
                    <label>URL *</label>
                    <input type="url" id="linkUrl" placeholder="https://example.com" required>
                </div>
                <div class="form-group">
                    <label>Icon (optional)</label>
                    <input type="text" id="linkIcon" placeholder="üìÑ" maxlength="2">
                    <small style="color: #6B7280; font-size: 12px;">Enter an emoji or leave blank</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeLinkModal()">Cancel</button>
                    <button type="submit" class="submit-btn">Save Link</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Attendees Modal -->
    <div class="modal" id="attendeesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Manage Confirmed Attendees</h2>
                <button class="close-modal" onclick="closeAttendeesModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>Enter Attendee Names</label>
                <textarea id="attendeesInput" placeholder="Enter names separated by commas or on separate lines:&#10;John Doe, Jane Smith&#10;or&#10;John Doe&#10;Jane Smith" style="width: 100%; min-height: 200px; padding: 12px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                <small style="color: #6B7280; font-size: 12px; display: block; margin-top: 8px;">
                    Separate names with commas or put each name on a new line
                </small>
            </div>
            <div class="form-actions">
                <button type="button" class="cancel-btn" onclick="closeAttendeesModal()">Cancel</button>
                <button type="button" class="submit-btn" onclick="saveAttendees()">Save Attendees</button>
            </div>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div class="modal" id="projectDetailsModal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2 class="modal-title" id="projectDetailsTitle">Project Details</h2>
                <button class="close-modal" onclick="closeProjectDetailsModal()">&times;</button>
            </div>
            <div id="projectDetailsContent"></div>
        </div>
    </div>

    <script>
        // User roles and permissions
        const USER_ROLES = {
            PUBLIC: { name: 'Public', role: 'View Only', canEdit: false, password: 'ecumenical2026' },
            ADMIN: { name: 'Justo', role: 'Admin', canEdit: true, password: 'Justo' },
            CONSULTANT: { name: 'Alexei', role: 'Consultant', canEdit: true, password: 'Alexei' }
        };

        let currentUser = null;
        let rsvpCount = 0;
        let projects = [];
        let contracts = [];
        let importantLinks = [];
        let zoomLink = '';
        let webhookUrl = 'https://justooppus.app.n8n.cloud/webhook-test/b55d8533-4bb4-47d6-93b9-35ad6a4401e1';
        let attendees = [];

        // Login
        function login() {
            const password = document.getElementById('passwordInput').value;
            
            for (const key in USER_ROLES) {
                if (USER_ROLES[key].password === password) {
                    currentUser = USER_ROLES[key];
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('appContainer').style.display = 'block';
                    document.getElementById('userName').textContent = currentUser.name;
                    document.getElementById('userRole').textContent = currentUser.role;
                    
                    updateUIPermissions();
                    loadData();
                    return;
                }
            }
            
            document.getElementById('errorMessage').style.display = 'block';
        }

        function logout() {
            currentUser = null;
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('passwordInput').value = '';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function updateUIPermissions() {
            const canEdit = currentUser && currentUser.canEdit;
            
            // RSVP controls
            const rsvpControls = document.getElementById('rsvpControls');
            if (rsvpControls) {
                rsvpControls.style.display = canEdit ? 'flex' : 'none';
            }

            // Completed projects card - hide for public view
            const completedProjectsCard = document.getElementById('completedProjectsCard');
            if (completedProjectsCard) {
                completedProjectsCard.style.display = canEdit ? 'block' : 'none';
            }

            // Add project button
            const addProjectBtn = document.getElementById('addProjectBtn');
            if (addProjectBtn) {
                addProjectBtn.disabled = !canEdit;
                addProjectBtn.classList.toggle('disabled', !canEdit);
            }

            // Upload contract button
            const uploadContractBtn = document.getElementById('uploadContractBtn');
            if (uploadContractBtn) {
                uploadContractBtn.disabled = !canEdit;
                uploadContractBtn.classList.toggle('disabled', !canEdit);
            }

            // Add link button
            const addLinkBtn = document.getElementById('addLinkBtn');
            if (addLinkBtn) {
                addLinkBtn.style.display = canEdit ? 'flex' : 'none';
            }

            // Zoom link admin controls
            const zoomAdminControls = document.getElementById('zoomAdminControls');
            if (zoomAdminControls) {
                zoomAdminControls.style.display = canEdit ? 'block' : 'none';
            }

            // Settings tab - only visible to admins
            const settingsTab = document.getElementById('settingsTab');
            if (settingsTab) {
                settingsTab.style.display = canEdit ? 'block' : 'none';
            }

            // Manage attendees button - only visible to admins
            const manageAttendeesBtn = document.getElementById('manageAttendeesBtn');
            if (manageAttendeesBtn) {
                manageAttendeesBtn.style.display = canEdit ? 'block' : 'none';
            }

            // Manage attendees button on attendees page
            const manageAttendeesBtn2 = document.getElementById('manageAttendeesBtn2');
            if (manageAttendeesBtn2) {
                manageAttendeesBtn2.style.display = canEdit ? 'flex' : 'none';
            }
        }

        // Allow Enter key to login
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
        });

        // Load and Save Data
        function loadData() {
            const savedRSVP = localStorage.getItem('ecumenical_rsvp');
            const savedProjects = localStorage.getItem('ecumenical_projects');
            const savedContracts = localStorage.getItem('ecumenical_contracts');
            const savedLinks = localStorage.getItem('ecumenical_links');
            const savedZoomLink = localStorage.getItem('ecumenical_zoom_link');
            const savedWebhookUrl = localStorage.getItem('ecumenical_webhook_url');
            const savedAttendees = localStorage.getItem('ecumenical_attendees');
            
            if (savedRSVP) rsvpCount = parseInt(savedRSVP);
            if (savedProjects) projects = JSON.parse(savedProjects);
            if (savedContracts) contracts = JSON.parse(savedContracts);
            if (savedAttendees) attendees = JSON.parse(savedAttendees);
            if (savedZoomLink) {
                zoomLink = savedZoomLink;
                updateZoomLinkDisplay();
            }
            if (savedWebhookUrl) {
                webhookUrl = savedWebhookUrl;
                const webhookInput = document.getElementById('webhookUrlInput');
                if (webhookInput) webhookInput.value = webhookUrl;
            }
            
            if (savedLinks) {
                importantLinks = JSON.parse(savedLinks);
            } else {
                // Initialize with default links
                importantLinks = [
                    {
                        id: Date.now() + 1,
                        name: 'RSVP Tracker',
                        url: 'https://docs.google.com/spreadsheets/d/1VpIU1mzT3MqRpWePdpXHspR8Gz9qnH7_SpdTHRijpqU/edit?gid=0#gid=0',
                        icon: 'üìä'
                    },
                    {
                        id: Date.now() + 2,
                        name: 'Foundational Documents',
                        url: '#',
                        icon: 'üìÑ'
                    },
                    {
                        id: 'contracts-link',
                        name: 'Contracts',
                        url: 'internal-contracts',
                        icon: 'üìÅ'
                    },
                    {
                        id: Date.now() + 3,
                        name: 'Profit & Loss',
                        url: '#',
                        icon: 'üí∞'
                    }
                ];
            }
            
            updateDashboard();
            renderProjects();
            renderContracts();
            renderImportantLinks();
            renderAttendees();
        }

        function saveData() {
            localStorage.setItem('ecumenical_rsvp', rsvpCount);
            localStorage.setItem('ecumenical_projects', JSON.stringify(projects));
            localStorage.setItem('ecumenical_contracts', JSON.stringify(contracts));
            localStorage.setItem('ecumenical_links', JSON.stringify(importantLinks));
            localStorage.setItem('ecumenical_zoom_link', zoomLink);
            localStorage.setItem('ecumenical_webhook_url', webhookUrl);
            localStorage.setItem('ecumenical_attendees', JSON.stringify(attendees));
        }

        // Navigation
        function switchPage(pageName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));

            if (pageName === 'dashboard') {
                document.getElementById('dashboardPage').classList.add('active');
                updateDashboard();
            } else if (pageName === 'projects') {
                document.getElementById('projectsPage').classList.add('active');
            } else if (pageName === 'attendees') {
                document.getElementById('attendeesPage').classList.add('active');
                renderAttendeesPage();
            } else if (pageName === 'contracts') {
                document.getElementById('contractsPage').classList.add('active');
            } else if (pageName === 'settings') {
                document.getElementById('settingsPage').classList.add('active');
            }
        }

        // Dashboard
        function updateDashboard() {
            document.getElementById('rsvpCount').textContent = rsvpCount;
            
            const activeProjects = projects.filter(p => p.status !== 'completed');
            const completedProjects = projects.filter(p => p.status === 'completed');
            
            document.getElementById('activeProjectsCount').textContent = activeProjects.length;
            document.getElementById('completedProjectsCount').textContent = completedProjects.length;
            
            renderDashboardProjects();
        }

        function adjustRSVP(change) {
            if (!currentUser || !currentUser.canEdit) return;
            rsvpCount = Math.max(0, rsvpCount + change);
            updateDashboard();
            saveData();
        }

        function renderDashboardProjects() {
            const container = document.getElementById('dashboardProjectsList');
            const activeProjects = projects.filter(p => p.status !== 'completed');

            if (activeProjects.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No active projects</h3><p>All projects are completed or you haven\'t created any yet</p></div>';
                return;
            }

            container.innerHTML = activeProjects.map(project => `
                <div class="board-row" onclick="viewProjectFromDashboard(${project.id})">
                    <div class="project-name">${project.name}</div>
                    <div class="assigned-cell">${project.assigned || 'Unassigned'}</div>
                    <div class="date-cell">${project.dueDate || 'No date'}</div>
                    <div><span class="status-select status-${project.status}">${formatStatus(project.status)}</span></div>
                    <div>
                        <span class="count-badge">üìã ${project.subtasks.length}</span>
                        <span class="count-badge">üìé ${project.files.length}</span>
                    </div>
                    <div></div>
                </div>
            `).join('');
        }

        function viewProjectFromDashboard(projectId) {
            switchPage('projects');
            setTimeout(() => {
                const details = document.getElementById(`details-${projectId}`);
                if (details && !details.classList.contains('expanded')) {
                    toggleProjectDetails(projectId);
                }
                details?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // Projects
        function renderProjects() {
            const container = document.getElementById('projectsList');
            const canEdit = currentUser && currentUser.canEdit;

            if (projects.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No projects yet</h3><p>Click "Add Project" to get started</p></div>';
                return;
            }

            container.innerHTML = projects.map(project => `
                <div class="board-row" onclick="openProjectDetailsModal(${project.id})" style="cursor: pointer;">
                    <div class="project-name">
                        <span style="color: #9CA3AF; font-size: 12px; margin-right: 8px;">‚ñ∂</span>
                        ${project.name}
                    </div>
                    <div class="assigned-cell">${project.assigned || 'Unassigned'}</div>
                    <div class="date-cell">${project.dueDate || 'No date'}</div>
                    <div>
                        <select class="status-select status-${project.status}" onchange="updateProjectStatus(${project.id}, this.value)" ${!canEdit ? 'disabled' : ''} onclick="event.stopPropagation()">
                            <option value="not-started" ${project.status === 'not-started' ? 'selected' : ''}>Not Started</option>
                            <option value="in-progress" ${project.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                            <option value="completed" ${project.status === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </div>
                    <div>
                        <span class="count-badge">üìã ${project.subtasks.length}</span>
                        <span class="count-badge">üìé ${project.files.length}</span>
                        <span class="count-badge">üí¨ ${project.comments.length}</span>
                    </div>
                    <div class="row-actions" onclick="event.stopPropagation()">
                        <button class="action-icon-btn" onclick="openProjectModal(${project.id})" ${!canEdit ? 'disabled' : ''} title="Edit Project">‚úèÔ∏è</button>
                        <button class="action-icon-btn delete" onclick="deleteProject(${project.id})" ${!canEdit ? 'disabled' : ''} title="Delete Project">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');

            updateDashboard();
        }

        function openProjectDetailsModal(projectId) {
            const project = projects.find(p => p.id == projectId);
            if (!project) return;

            const canEdit = currentUser && currentUser.canEdit;
            const modal = document.getElementById('projectDetailsModal');
            const content = document.getElementById('projectDetailsContent');
            
            document.getElementById('projectDetailsTitle').textContent = project.name;
            
            content.innerHTML = `
                <div class="project-details-meta">
                    <div class="meta-box">
                        <div class="meta-box-label">Status</div>
                        <div class="meta-box-value">
                            <span class="status-badge status-${project.status}">${formatStatus(project.status)}</span>
                        </div>
                    </div>
                    <div class="meta-box">
                        <div class="meta-box-label">Assigned To</div>
                        <div class="meta-box-value">${project.assigned || 'Unassigned'}</div>
                    </div>
                    <div class="meta-box">
                        <div class="meta-box-label">Due Date</div>
                        <div class="meta-box-value">${project.dueDate || 'No due date'}</div>
                    </div>
                    <div class="meta-box">
                        <div class="meta-box-label">Items</div>
                        <div class="meta-box-value">
                            <span class="count-badge">üìã ${project.subtasks.length}</span>
                            <span class="count-badge">üìé ${project.files.length}</span>
                            <span class="count-badge">üí¨ ${project.comments.length}</span>
                        </div>
                    </div>
                </div>

                <div class="project-details-grid">
                    <div class="project-details-section full-width-section">
                        <h3>Overview</h3>
                        <div class="description-box" style="background: white; margin-top: 0;">${project.description || 'No description provided'}</div>
                    </div>

                    <div class="project-details-section">
                        <h3>
                            <span>Subtasks (${project.subtasks.length})</span>
                            ${canEdit ? `<button class="small-btn" onclick="openSubtaskModal(${project.id}); closeProjectDetailsModal();">+ Add</button>` : ''}
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${project.subtasks.length === 0 ? '<div style="text-align: center; padding: 24px; color: #9CA3AF;">No subtasks yet</div>' : project.subtasks.map(subtask => `
                                <div class="subtask-item" style="background: white; margin-bottom: 12px;">
                                    <div class="subtask-name">${subtask.name}</div>
                                    <div style="font-size: 13px; margin-top: 4px; color: #6B7280;">üë§ ${subtask.assigned || 'Unassigned'} ‚Ä¢ üìÖ ${subtask.dueDate || 'No date'}</div>
                                    ${subtask.description ? `<div style="font-size: 13px; margin-top: 6px; color: #6B7280;">${subtask.description}</div>` : ''}
                                    <div style="display: flex; gap: 8px; align-items: center; margin-top: 8px;">
                                        <span class="status-badge status-${subtask.status}">${formatStatus(subtask.status)}</span>
                                        ${canEdit ? `
                                        <button class="small-btn" onclick="openSubtaskModal(${project.id}, ${subtask.id}); closeProjectDetailsModal();">Edit</button>
                                        <button class="small-btn delete" onclick="if(confirm('Delete?')) { deleteSubtask(${project.id}, ${subtask.id}); openProjectDetailsModal(${project.id}); }">Delete</button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="project-details-section">
                        <h3>Files (${project.files.length})</h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${project.files.length === 0 ? '<div style="text-align: center; padding: 24px; color: #9CA3AF;">No files uploaded yet</div>' : project.files.map(file => `
                                <div class="file-item" style="background: white; margin-bottom: 12px;">
                                    <div class="file-name">üìÑ ${file.name}</div>
                                    <div class="file-actions">
                                        <button class="download-btn" onclick="downloadFile(${project.id}, '${file.id}')">Download</button>
                                        ${canEdit ? `<button class="small-btn delete" onclick="if(confirm('Delete?')) { deleteFile(${project.id}, '${file.id}'); openProjectDetailsModal(${project.id}); }">Del</button>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                            ${canEdit ? `
                            <div class="upload-area" style="margin-top: 16px;">
                                <input type="file" id="file-modal-${project.id}" multiple onchange="uploadFileModal(${project.id})">
                                <label class="upload-label" for="file-modal-${project.id}">Choose Files</label>
                            </div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="project-details-section full-width-section">
                        <h3>Comments (${project.comments.length})</h3>
                        <div style="max-height: 350px; overflow-y: auto; margin-bottom: 16px;">
                            ${project.comments.length === 0 ? '<div style="text-align: center; padding: 24px; color: #9CA3AF;">No comments yet</div>' : project.comments.map(comment => `
                                <div class="comment-item" style="background: white; margin-bottom: 12px;">
                                    <div class="comment-header">
                                        <span class="comment-author">${comment.author}</span>
                                        <span class="comment-time">${formatDate(comment.timestamp)}</span>
                                    </div>
                                    <div class="comment-text">${comment.text}</div>
                                </div>
                            `).join('')}
                        </div>
                        ${canEdit ? `
                        <div class="comment-form" style="background: white; padding: 16px; border-radius: 8px;">
                            <input type="text" id="comment-author-modal-${project.id}" placeholder="Your name" value="${currentUser.name}" style="margin-bottom: 12px;">
                            <textarea id="comment-text-modal-${project.id}" placeholder="Add a comment..." style="margin-bottom: 12px;"></textarea>
                            <button class="submit-comment-btn" onclick="addCommentModal(${project.id})">Post</button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function closeProjectDetailsModal() {
            document.getElementById('projectDetailsModal').classList.remove('active');
        }

        function uploadFileModal(projectId) {
            if (!currentUser || !currentUser.canEdit) return;
            const input = document.getElementById(`file-modal-${projectId}`);
            const files = input.files;
            if (files.length === 0) return;
            const project = projects.find(p => p.id == projectId);
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    project.files.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        data: e.target.result,
                        uploadedAt: new Date().toISOString()
                    });
                    saveData();
                    renderProjects();
                    openProjectDetailsModal(projectId);
                };
                reader.readAsDataURL(file);
            });
            input.value = '';
        }

        function addCommentModal(projectId) {
            if (!currentUser || !currentUser.canEdit) return;
            const author = document.getElementById(`comment-author-modal-${projectId}`).value.trim();
            const text = document.getElementById(`comment-text-modal-${projectId}`).value.trim();
            if (!author || !text) {
                alert('Please enter your name and comment');
                return;
            }
            const project = projects.find(p => p.id == projectId);
            project.comments.push({
                id: Date.now(),
                author: author,
                text: text,
                timestamp: new Date().toISOString()
            });
            saveData();
            renderProjects();
            openProjectDetailsModal(projectId);
        }

        function toggleProjectDetails(projectId) {
            const details = document.getElementById(`details-${projectId}`);
            const icon = document.getElementById(`expand-${projectId}`);
            
            details.classList.toggle('expanded');
            icon.classList.toggle('expanded');
        }

        function switchDetailTab(projectId, tabName) {
            const tabs = document.querySelectorAll(`#details-${projectId} .detail-tab`);
            const contents = document.querySelectorAll(`#details-${projectId} .detail-content`);
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-${projectId}`).classList.add('active');
        }

        function updateProjectStatus(projectId, status) {
            if (!currentUser || !currentUser.canEdit) return;
            
            const project = projects.find(p => p.id == projectId);
            if (project) {
                project.status = status;
                saveData();
                renderProjects();
            }
        }

        function openProjectModal(projectId = null) {
            if (!currentUser || !currentUser.canEdit) return;
            
            const modal = document.getElementById('projectModal');
            const form = document.getElementById('projectForm');
            
            if (projectId) {
                const project = projects.find(p => p.id == projectId);
                document.getElementById('modalTitle').textContent = 'Edit Project';
                document.getElementById('projectId').value = project.id;
                document.getElementById('projectName').value = project.name;
                document.getElementById('projectDescription').value = project.description || '';
                document.getElementById('projectDueDate').value = project.dueDate || '';
                document.getElementById('projectStatus').value = project.status;
                document.getElementById('projectAssigned').value = project.assigned || '';
            } else {
                document.getElementById('modalTitle').textContent = 'Add New Project';
                form.reset();
            }
            
            modal.classList.add('active');
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.remove('active');
            document.getElementById('projectForm').reset();
        }

        document.getElementById('projectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentUser || !currentUser.canEdit) return;
            
            const projectId = document.getElementById('projectId').value;
            const projectData = {
                id: projectId || Date.now(),
                name: document.getElementById('projectName').value,
                description: document.getElementById('projectDescription').value,
                dueDate: document.getElementById('projectDueDate').value,
                status: document.getElementById('projectStatus').value,
                assigned: document.getElementById('projectAssigned').value,
                subtasks: [],
                files: [],
                comments: []
            };

            if (projectId) {
                const index = projects.findIndex(p => p.id == projectId);
                const existingProject = projects[index];
                projectData.subtasks = existingProject.subtasks;
                projectData.files = existingProject.files;
                projectData.comments = existingProject.comments;
                projects[index] = projectData;
            } else {
                projects.push(projectData);
            }

            saveData();
            renderProjects();
            closeProjectModal();
        });

        function deleteProject(projectId) {
            if (!currentUser || !currentUser.canEdit) return;
            
            if (confirm('Are you sure you want to delete this project?')) {
                projects = projects.filter(p => p.id != projectId);
                saveData();
                renderProjects();
            }
        }

        // Subtasks
        function openSubtaskModal(projectId, subtaskId = null) {
            if (!currentUser || !currentUser.canEdit) return;
            
            const modal = document.getElementById('subtaskModal');
            const form = document.getElementById('subtaskForm');
            
            document.getElementById('subtaskProjectId').value = projectId;
            
            if (subtaskId) {
                const project = projects.find(p => p.id == projectId);
                const subtask = project.subtasks.find(s => s.id == subtaskId);
                document.getElementById('subtaskModalTitle').textContent = 'Edit Subtask';
                document.getElementById('subtaskId').value = subtask.id;
                document.getElementById('subtaskName').value = subtask.name;
                document.getElementById('subtaskDescription').value = subtask.description || '';
                document.getElementById('subtaskDueDate').value = subtask.dueDate || '';
                document.getElementById('subtaskStatus').value = subtask.status;
                document.getElementById('subtaskAssigned').value = subtask.assigned || '';
            } else {
                document.getElementById('subtaskModalTitle').textContent = 'Add Subtask';
                form.reset();
                document.getElementById('subtaskProjectId').value = projectId;
            }
            
            modal.classList.add('active');
        }

        function closeSubtaskModal() {
            document.getElementById('subtaskModal').classList.remove('active');
            document.getElementById('subtaskForm').reset();
        }

        document.getElementById('subtaskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentUser || !currentUser.canEdit) return;
            
            const projectId = document.getElementById('subtaskProjectId').value;
            const subtaskId = document.getElementById('subtaskId').value;
            
            const subtaskData = {
                id: subtaskId || Date.now(),
                name: document.getElementById('subtaskName').value,
                description: document.getElementById('subtaskDescription').value,
                dueDate: document.getElementById('subtaskDueDate').value,
                status: document.getElementById('subtaskStatus').value,
                assigned: document.getElementById('subtaskAssigned').value
            };

            const project = projects.find(p => p.id == projectId);
            
            if (subtaskId) {
                const index = project.subtasks.findIndex(s => s.id == subtaskId);
                project.subtasks[index] = subtaskData;
            } else {
                project.subtasks.push(subtaskData);
            }

            saveData();
            renderProjects();
            closeSubtaskModal();
        });

        function deleteSubtask(projectId, subtaskId) {
            if (!currentUser || !currentUser.canEdit) return;
            
            if (confirm('Are you sure you want to delete this subtask?')) {
                const project = projects.find(p => p.id == projectId);
                project.subtasks = project.subtasks.filter(s => s.id != subtaskId);
                saveData();
                renderProjects();
            }
        }

        // Files
        function uploadFile(projectId) {
            if (!currentUser || !currentUser.canEdit) return;
            
            const input = document.getElementById(`file-${projectId}`);
            const files = input.files;
            
            if (files.length === 0) return;

            const project = projects.find(p => p.id == projectId);
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    project.files.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        data: e.target.result,
                        uploadedAt: new Date().toISOString()
                    });
                    saveData();
                    renderProjects();
                };
                reader.readAsDataURL(file);
            });
            
            input.value = '';
        }

        function downloadFile(projectId, fileId) {
            const project = projects.find(p => p.id == projectId);
            const file = project.files.find(f => f.id == fileId);
            
            if (file) {
                const link = document.createElement('a');
                link.href = file.data;
                link.download = file.name;
                link.click();
            }
        }

        function deleteFile(projectId, fileId) {
            if (!currentUser || !currentUser.canEdit) return;
            
            if (confirm('Are you sure you want to delete this file?')) {
                const project = projects.find(p => p.id == projectId);
                project.files = project.files.filter(f => f.id != fileId);
                saveData();
                renderProjects();
            }
        }

        // Comments
        function addComment(projectId) {
            if (!currentUser || !currentUser.canEdit) return;
            
            const author = document.getElementById(`comment-author-${projectId}`).value.trim();
            const text = document.getElementById(`comment-text-${projectId}`).value.trim();
            
            if (!author || !text) {
                alert('Please enter your name and comment');
                return;
            }

            const project = projects.find(p => p.id == projectId);
            project.comments.push({
                id: Date.now(),
                author: author,
                text: text,
                timestamp: new Date().toISOString()
            });

            document.getElementById(`comment-text-${projectId}`).value = '';
            
            saveData();
            renderProjects();
        }

        // Contracts
        function uploadContract(input) {
            if (!currentUser || !currentUser.canEdit) return;
            
            const files = input.files;
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    contracts.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        data: e.target.result,
                        uploadedAt: new Date().toISOString()
                    });
                    saveData();
                    renderContracts();
                };
                reader.readAsDataURL(file);
            }
            input.value = '';
        }

        function renderContracts() {
            const container = document.getElementById('contractsList');
            const canEdit = currentUser && currentUser.canEdit;

            if (contracts.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No contracts uploaded yet</h3><p>Click "Upload Contract" to add files</p></div>';
                return;
            }

            container.innerHTML = contracts.map(contract => `
                <div class="file-item">
                    <div class="file-name">üìÑ ${contract.name}</div>
                    <div class="file-actions">
                        <button class="download-btn" onclick="downloadContract('${contract.id}')">Download</button>
                        ${canEdit ? `<button class="small-btn delete" onclick="deleteContract('${contract.id}')">Delete</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function downloadContract(id) {
            const contract = contracts.find(c => c.id == id);
            if (contract) {
                const link = document.createElement('a');
                link.href = contract.data;
                link.download = contract.name;
                link.click();
            }
        }

        function deleteContract(id) {
            if (!currentUser || !currentUser.canEdit) return;
            
            if (confirm('Are you sure you want to delete this contract?')) {
                contracts = contracts.filter(c => c.id != id);
                saveData();
                renderContracts();
            }
        }

        // Utilities
        function formatStatus(status) {
            return status.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
        }

        // Important Links Management
        function renderImportantLinks() {
            const container = document.getElementById('importantLinksList');
            const canEdit = currentUser && currentUser.canEdit;

            container.innerHTML = importantLinks.map(link => {
                const isContractsLink = link.url === 'internal-contracts';
                
                if (isContractsLink) {
                    return `
                        <div class="link-card" onclick="switchPage('contracts')" style="position: relative;">
                            ${link.icon || 'üîó'} ${link.name}
                            ${canEdit ? `
                            <button class="action-icon-btn" style="position: absolute; top: 8px; right: 8px; z-index: 10;" onclick="event.stopPropagation(); event.preventDefault(); openLinkModal('${link.id}'); return false;">‚úèÔ∏è</button>
                            ` : ''}
                        </div>
                    `;
                } else {
                    const clickHandler = link.url === '#' ? 'onclick="alert(\'Please update this link\'); return false;"' : '';
                    return `
                        <a href="${link.url}" target="_blank" class="link-card" style="position: relative;" ${clickHandler}>
                            ${link.icon || 'üîó'} ${link.name}
                            ${canEdit ? `
                            <button class="action-icon-btn" style="position: absolute; top: 8px; right: 8px; z-index: 10;" onclick="event.stopPropagation(); event.preventDefault(); openLinkModal('${link.id}'); return false;">‚úèÔ∏è</button>
                            <button class="action-icon-btn delete" style="position: absolute; top: 8px; right: 40px; z-index: 10;" onclick="event.stopPropagation(); event.preventDefault(); deleteLink('${link.id}'); return false;">üóëÔ∏è</button>
                            ` : ''}
                        </a>
                    `;
                }
            }).join('');
        }

        function openLinkModal(linkId = null) {
            if (!currentUser || !currentUser.canEdit) return;
            
            const modal = document.getElementById('linkModal');
            const form = document.getElementById('linkForm');
            
            if (linkId) {
                const link = importantLinks.find(l => l.id == linkId);
                document.getElementById('linkModalTitle').textContent = 'Edit Link';
                document.getElementById('linkId').value = link.id;
                document.getElementById('linkName').value = link.name;
                document.getElementById('linkUrl').value = link.url === 'internal-contracts' ? 'internal-contracts' : link.url;
                document.getElementById('linkIcon').value = link.icon || '';
                
                // Disable URL field for contracts link
                if (link.url === 'internal-contracts') {
                    document.getElementById('linkUrl').disabled = true;
                }
            } else {
                document.getElementById('linkModalTitle').textContent = 'Add Link';
                form.reset();
                document.getElementById('linkUrl').disabled = false;
            }
            
            modal.classList.add('active');
        }

        function closeLinkModal() {
            document.getElementById('linkModal').classList.remove('active');
            document.getElementById('linkForm').reset();
            document.getElementById('linkUrl').disabled = false;
        }

        document.getElementById('linkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentUser || !currentUser.canEdit) return;
            
            const linkId = document.getElementById('linkId').value;
            const linkData = {
                id: linkId || Date.now(),
                name: document.getElementById('linkName').value,
                url: document.getElementById('linkUrl').value,
                icon: document.getElementById('linkIcon').value || 'üîó'
            };

            if (linkId) {
                const index = importantLinks.findIndex(l => l.id == linkId);
                importantLinks[index] = linkData;
            } else {
                importantLinks.push(linkData);
            }

            saveData();
            renderImportantLinks();
            closeLinkModal();
        });

        function deleteLink(linkId) {
            if (!currentUser || !currentUser.canEdit) return;
            
            if (confirm('Are you sure you want to delete this link?')) {
                importantLinks = importantLinks.filter(l => l.id != linkId);
                saveData();
                renderImportantLinks();
            }
        }

        // Zoom Link Management
        function saveZoomLink() {
            const link = document.getElementById('zoomLinkInput').value.trim();
            if (!link) {
                alert('Please enter a Zoom link');
                return;
            }
            
            zoomLink = link;
            saveData();
            updateZoomLinkDisplay();
            alert('Zoom link saved successfully!');
        }

        function updateZoomLinkDisplay() {
            const input = document.getElementById('zoomLinkInput');
            const button = document.getElementById('zoomLinkButton');
            const notSet = document.getElementById('zoomNotSet');
            
            if (zoomLink) {
                if (input) input.value = zoomLink;
                button.href = zoomLink;
                button.style.display = 'block';
                notSet.style.display = 'none';
            } else {
                button.style.display = 'none';
                if (!currentUser || !currentUser.canEdit) {
                    notSet.style.display = 'block';
                }
            }
        }

        // Invitation Form Submission
        document.getElementById('invitationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!webhookUrl) {
                alert('Webhook URL not configured. Please ask an administrator to set it up in Settings.');
                return;
            }
            
            const formData = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                email: document.getElementById('email').value.trim(),
                timestamp: new Date().toISOString()
            };

            const successMsg = document.getElementById('formSuccess');
            const errorMsg = document.getElementById('formError');
            
            // Hide previous messages
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                // Send to n8n webhook
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    // Success
                    successMsg.style.display = 'block';
                    document.getElementById('invitationForm').reset();
                    
                    // Hide success message after 5 seconds
                    setTimeout(() => {
                        successMsg.style.display = 'none';
                    }, 5000);
                } else {
                    throw new Error('Server responded with error');
                }
            } catch (error) {
                console.error('Form submission error:', error);
                errorMsg.style.display = 'block';
                
                // Hide error message after 5 seconds
                setTimeout(() => {
                    errorMsg.style.display = 'none';
                }, 5000);
            }
        });

        // Settings Functions
        function saveWebhookUrl() {
            const url = document.getElementById('webhookUrlInput').value.trim();
            
            const successMsg = document.getElementById('settingsSuccess');
            const errorMsg = document.getElementById('settingsError');
            
            // Hide previous messages
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            
            // Basic URL validation
            if (!url) {
                errorMsg.textContent = 'Please enter a webhook URL.';
                errorMsg.style.display = 'block';
                return;
            }
            
            try {
                new URL(url); // Validate URL format
                webhookUrl = url;
                saveData();
                successMsg.style.display = 'block';
                
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 3000);
            } catch (e) {
                errorMsg.textContent = 'Invalid URL format. Please enter a valid webhook URL.';
                errorMsg.style.display = 'block';
            }
        }

        async function testWebhook() {
            const url = document.getElementById('webhookUrlInput').value.trim();
            
            const successMsg = document.getElementById('testSuccess');
            const errorMsg = document.getElementById('testError');
            
            // Hide previous messages
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            
            if (!url) {
                errorMsg.textContent = 'Please enter a webhook URL first.';
                errorMsg.style.display = 'block';
                return;
            }
            
            try {
                // Send test payload
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        firstName: 'Test',
                        lastName: 'User',
                        email: 'test@example.com',
                        timestamp: new Date().toISOString(),
                        test: true
                    })
                });

                if (response.ok) {
                    successMsg.style.display = 'block';
                    setTimeout(() => {
                        successMsg.style.display = 'none';
                    }, 5000);
                } else {
                    throw new Error('Webhook responded with error');
                }
            } catch (error) {
                console.error('Webhook test error:', error);
                errorMsg.textContent = 'Connection failed. Please check the URL and ensure your n8n workflow is active.';
                errorMsg.style.display = 'block';
                setTimeout(() => {
                    errorMsg.style.display = 'none';
                }, 5000);
            }
        }

        // Attendees Management
        function renderAttendees() {
            const container = document.getElementById('attendeesList');
            const noAttendees = document.getElementById('noAttendees');
            
            if (!attendees || attendees.length === 0) {
                container.innerHTML = '';
                noAttendees.style.display = 'block';
                return;
            }
            
            noAttendees.style.display = 'none';
            
            // Create attendee items (duplicate for scrolling effect)
            const attendeeItems = attendees.map(name => 
                `<div class="attendee-item">${name}</div>`
            ).join('');
            
            // If there are enough attendees to scroll, duplicate the list
            if (attendees.length > 4) {
                container.innerHTML = `
                    <div class="attendees-scroll-container scrolling" style="animation-duration: ${attendees.length * 3}s;">
                        ${attendeeItems}
                        ${attendeeItems}
                    </div>
                `;
            } else {
                container.innerHTML = attendeeItems;
            }
        }

        function renderAttendeesPage() {
            const grid = document.getElementById('attendeesGrid');
            const noAttendeesPage = document.getElementById('noAttendeesPage');
            const totalCount = document.getElementById('totalAttendeesCount');
            const displayedCount = document.getElementById('displayedAttendeesCount');
            const searchInput = document.getElementById('attendeeSearch');
            
            // Reset search
            if (searchInput) searchInput.value = '';
            
            if (!attendees || attendees.length === 0) {
                grid.innerHTML = '';
                noAttendeesPage.style.display = 'block';
                totalCount.textContent = '0';
                displayedCount.textContent = '0';
                return;
            }
            
            noAttendeesPage.style.display = 'none';
            totalCount.textContent = attendees.length;
            displayedCount.textContent = attendees.length;
            
            // Sort alphabetically
            const sortedAttendees = [...attendees].sort((a, b) => a.localeCompare(b));
            
            grid.innerHTML = sortedAttendees.map((name, index) => `
                <div class="attendee-card" data-name="${name.toLowerCase()}">
                    <div class="attendee-name">${name}</div>
                    <div class="attendee-number">#${index + 1}</div>
                </div>
            `).join('');
        }

        function filterAttendees() {
            const searchTerm = document.getElementById('attendeeSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.attendee-card');
            const noResults = document.getElementById('noSearchResults');
            const grid = document.getElementById('attendeesGrid');
            const displayedCount = document.getElementById('displayedAttendeesCount');
            
            let visibleCount = 0;
            
            cards.forEach(card => {
                const name = card.getAttribute('data-name');
                if (name.includes(searchTerm)) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            displayedCount.textContent = visibleCount;
            
            if (visibleCount === 0 && searchTerm !== '') {
                noResults.style.display = 'block';
                grid.style.display = 'none';
            } else {
                noResults.style.display = 'none';
                grid.style.display = 'grid';
            }
        }

        function openAttendeesModal() {
            if (!currentUser || !currentUser.canEdit) return;
            
            const modal = document.getElementById('attendeesModal');
            const input = document.getElementById('attendeesInput');
            
            // Pre-fill with existing attendees (one per line)
            input.value = attendees.join('\n');
            
            modal.classList.add('active');
        }

        function closeAttendeesModal() {
            document.getElementById('attendeesModal').classList.remove('active');
        }

        function saveAttendees() {
            if (!currentUser || !currentUser.canEdit) return;
            
            const input = document.getElementById('attendeesInput').value;
            
            // Parse input - split by commas or newlines, trim whitespace, filter empty
            let names = input
                .split(/[,\n]/)
                .map(name => name.trim())
                .filter(name => name.length > 0);
            
            // Remove duplicates
            names = [...new Set(names)];
            
            attendees = names;
            saveData();
            renderAttendees();
            renderAttendeesPage();
            closeAttendeesModal();
        }
    </script>
</body>
</html>
